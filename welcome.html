<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crypto Price Monitor</title>
  <style>
    body {
      margin: 0; min-height: 100svh; display: grid; place-items: center;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background: linear-gradient(135deg, #eff3ff, #fbfdff);
    }
    .wrap {
      background: white; padding: 32px 28px; border-radius: 18px;
      box-shadow: 0 10px 26px rgba(0,0,0,.07);
      text-align: center; width: min(640px, 92vw);
    }
    h1 { margin: 0 0 24px; font-size: 1.5rem; }
    .prices {
      display: grid;
      gap: 16px;
      margin-bottom: 24px;
    }
    .price-card {
      background: #f8faff;
      padding: 16px;
      border-radius: 12px;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 12px;
    }
    .symbol {
      font-weight: 600;
      color: #2c3e50;
      text-align: left;
    }
    .price {
      font-family: monospace;
      font-size: 1.1rem;
      color: #34495e;
    }
    .price.up { color: #2ecc71; }
    .price.down { color: #e74c3c; }
    a.btn {
      display: inline-block; text-decoration: none;
      padding: 10px 14px; border-radius: 12px; 
      background: #6b86ff; color: white; 
      font-weight: 600;
      transition: background-color 0.2s;
    }
    a.btn:hover {
      background: #5a75ee;
    }
    .last-update {
      font-size: 0.8rem;
      color: #7f8c8d;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ì•”í˜¸í™”í ì‹œì„¸ ëª¨ë‹ˆí„° ğŸš€</h1>
    <div class="prices">
      <div class="price-card">
        <span class="symbol">BTC/USDT</span>
        <span class="price" id="btc-price">ë¡œë”© ì¤‘...</span>
      </div>
      <div class="price-card">
        <span class="symbol">ETH/USDT</span>
        <span class="price" id="eth-price">ë¡œë”© ì¤‘...</span>
      </div>
      <div class="price-card">
        <span class="symbol">XRP/USDT</span>
        <span class="price" id="xrp-price">ë¡œë”© ì¤‘...</span>
      </div>
    </div>
    <a class="btn" href="index.html" onclick="sessionStorage.removeItem('authOK')">ë¡œê·¸ì•„ì›ƒ</a>
    <div class="last-update" id="last-update"></div>
  </div>

  <script>
    // index.htmlì—ì„œ ì„¸ì…˜ í”Œë˜ê·¸ê°€ ì—†ìœ¼ë©´ ì ‘ê·¼ ì°¨ë‹¨
    if (sessionStorage.getItem("authOK") !== "1") {
      location.replace("index.html");
    }

    // ì´ì „ ê°€ê²©ì„ ì €ì¥í•  ê°ì²´
    const prevPrices = {
      BTCUSDT: null,
      ETHUSDT: null,
      XRPUSDT: null
    };

    // ê°€ê²© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    async function updatePrices() {
      try {
        const symbols = ["BTCUSDT", "ETHUSDT", "XRPUSDT"];
        const response = await fetch('https://api.bybit.com/v5/market/tickers?category=spot');
        const data = await response.json();
        
        console.log('API Response:', data); // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
        
        if (data.retCode === 0) {
          const prices = data.result.list.filter(item => symbols.includes(item.symbol));
          console.log('Filtered prices:', prices); // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
          
          prices.forEach(item => {
            const symbol = item.symbol;
            const currentPrice = parseFloat(item.lastPrice || item.last);
            const prevPrice = prevPrices[symbol];
            const elementId = symbol.toLowerCase().replace('usdt', '-price');
            const element = document.getElementById(elementId);
            
            if (element) {
              // ê°€ê²© ë³€í™”ì— ë”°ë¥¸ í´ë˜ìŠ¤ ì„¤ì •
              element.classList.remove('up', 'down');
              if (prevPrice !== null) {
                if (currentPrice > prevPrice) {
                  element.classList.add('up');
                } else if (currentPrice < prevPrice) {
                  element.classList.add('down');
                }
              }
              
              // ê°€ê²© í‘œì‹œ (ì†Œìˆ˜ì  ìë¦¬ìˆ˜ ì¡°ì •)
              element.textContent = currentPrice.toLocaleString('en-US', {
                minimumFractionDigits: symbol.startsWith('XRP') ? 4 : 2,
                maximumFractionDigits: symbol.startsWith('XRP') ? 4 : 2
              });
              
              // í˜„ì¬ ê°€ê²©ì„ ì´ì „ ê°€ê²©ìœ¼ë¡œ ì €ì¥
              prevPrices[symbol] = currentPrice;
            }
          });
          
          // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
          document.getElementById('last-update').textContent = 
            `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString()}`;
        }
      } catch (error) {
        console.error('ê°€ê²© ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
      }
    }

    // ì´ˆê¸° ì—…ë°ì´íŠ¸
    updatePrices();

    // 1ì´ˆë§ˆë‹¤ ê°€ê²© ì—…ë°ì´íŠ¸
    setInterval(updatePrices, 1000);
  </script>
</body>
</html>
